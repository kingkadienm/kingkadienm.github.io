<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Android嵌套Flutter(上).md | Wangzs</title>
    <meta name="description" content="专注于记录技术点滴">
    
    
    <link rel="preload" href="/assets/css/0.styles.81305d55.css" as="style"><link rel="preload" href="/assets/js/app.dc8b9c2e.js" as="script"><link rel="preload" href="/assets/js/2.2ce75cd2.js" as="script"><link rel="preload" href="/assets/js/20.a6cf2b18.js" as="script"><link rel="prefetch" href="/assets/js/10.3673eef8.js"><link rel="prefetch" href="/assets/js/11.6380d265.js"><link rel="prefetch" href="/assets/js/12.1ad74874.js"><link rel="prefetch" href="/assets/js/13.d3688f98.js"><link rel="prefetch" href="/assets/js/14.24d3e4aa.js"><link rel="prefetch" href="/assets/js/15.d19f0f11.js"><link rel="prefetch" href="/assets/js/16.9b5095d6.js"><link rel="prefetch" href="/assets/js/17.135d44c5.js"><link rel="prefetch" href="/assets/js/18.b752264c.js"><link rel="prefetch" href="/assets/js/19.95321556.js"><link rel="prefetch" href="/assets/js/21.11f30b1f.js"><link rel="prefetch" href="/assets/js/22.48c0f6ff.js"><link rel="prefetch" href="/assets/js/23.873e1777.js"><link rel="prefetch" href="/assets/js/24.ac837064.js"><link rel="prefetch" href="/assets/js/25.ce3a3d27.js"><link rel="prefetch" href="/assets/js/26.e2766269.js"><link rel="prefetch" href="/assets/js/27.d67f48fd.js"><link rel="prefetch" href="/assets/js/28.e3d4055d.js"><link rel="prefetch" href="/assets/js/29.0f90cd48.js"><link rel="prefetch" href="/assets/js/3.720e05d7.js"><link rel="prefetch" href="/assets/js/30.7c6c2049.js"><link rel="prefetch" href="/assets/js/31.160a68f1.js"><link rel="prefetch" href="/assets/js/32.30b0f10f.js"><link rel="prefetch" href="/assets/js/33.17df866e.js"><link rel="prefetch" href="/assets/js/4.1bec1175.js"><link rel="prefetch" href="/assets/js/5.5a2d2444.js"><link rel="prefetch" href="/assets/js/6.204462d7.js"><link rel="prefetch" href="/assets/js/7.fb20a6bb.js"><link rel="prefetch" href="/assets/js/8.7d8b001f.js"><link rel="prefetch" href="/assets/js/9.6abd9b59.js">
    <link rel="stylesheet" href="/assets/css/0.styles.81305d55.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Wangzs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/android/" class="nav-link">Android</a></div><div class="nav-item"><a href="/flutter/" class="nav-link router-link-active">Flutter</a></div><div class="nav-item"><a href="/python/" class="nav-link">Python</a></div><div class="nav-item"><a href="/goland/" class="nav-link">Goland</a></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/react/" class="nav-link">React</a></div><div class="nav-item"><a href="/js/" class="nav-link">JS</a></div><div class="nav-item"><a href="/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/other/" class="nav-link">其他</a></div><div class="nav-item"><a href="https://github.com/kingkadienm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/android/" class="nav-link">Android</a></div><div class="nav-item"><a href="/flutter/" class="nav-link router-link-active">Flutter</a></div><div class="nav-item"><a href="/python/" class="nav-link">Python</a></div><div class="nav-item"><a href="/goland/" class="nav-link">Goland</a></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/react/" class="nav-link">React</a></div><div class="nav-item"><a href="/js/" class="nav-link">JS</a></div><div class="nav-item"><a href="/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/other/" class="nav-link">其他</a></div><div class="nav-item"><a href="https://github.com/kingkadienm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/flutter/" class="sidebar-link">导航</a></li><li><a href="/flutter/2019-11-22.html" class="sidebar-link">Flutter学习之Dart基础数据类型</a></li><li><a href="/flutter/2019-11-22_2.html" class="sidebar-link">Flutter学习之Dart运算符</a></li><li><a href="/flutter/Flutter2Android_1.html" class="active sidebar-link">Android嵌套Flutter(上).md</a></li><li><a href="/flutter/Flutter2Android_2.html" class="sidebar-link">Android嵌套Flutter(上).md</a></li><li><a href="/flutter/Flutter_plugin.html" class="sidebar-link">/flutter/Flutter_plugin.html</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="android嵌套flutter-上-md"><a href="#android嵌套flutter-上-md" aria-hidden="true" class="header-anchor">#</a> Android嵌套Flutter(上).md</h1> <p>本文记录一下Android主工程中嵌入部分Fluttter页面的实现方法。</p> <p>创建一个Android工程模拟你的现有工程
为了让Android工程和Flutter工程互不干扰，这里不再以Android工程为工程的跟目录，而是让Android工程和平级的Flutter工程的公共目录作为根目录。 最终的目录结构应该是下面这样的</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>你的项目根目录（随便什么你喜欢的地方）

  ├── 原生安卓工程（Flutter2App）
  └── Flutter工程 (plugin_test)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>所以首先在你的项目根目录下用AS创建一个新的Android原生项目，可以勾选上kotlin支持，这样更舒服。 创建完成后你会得到一个这样的结构</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>你的项目根目录（随便什么你喜欢的地方）

  └── Flutter2App
Flutter2App目录内是一个完整的Android工程
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>module模式创建Flutter工程
接下来使用Flutter命令来创建module工程，在你的项目根目录下执行：</p> <ul><li>$  flutter create -t module plugin_test
创建完成后你会得到一个这样的结构</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>你的项目根目录（随便什么你喜欢的地方）

  ├── Flutter2App

  └── plugin_test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>plugin_test是一个Flutter的module工程，用来供Android项目引入</p> <p>在Android工程中引入依赖</p> <p>在Flutter2App这个Android工程的setting.gradle文件中追加flutter工程的引入</p> <p>你的项目跟目录/Flutter2App/setting.gradle</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>include ':app'
setBinding(new Binding([gradle: this]))
evaluate(new File(
        settingsDir.parentFile,
        'Flutter2App/plugin_test/.android/include_flutter.groovy'
))
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在app的build.gradle文件中加入工程依赖</p> <p>你的项目跟目录/Flutter2App/app/build.gradle</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dependencies {
    // 加入下面配置implementation project(':flutter')
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation 'com.android.support:appcompat-v7:28.0.0'
    implementation 'com.android.support.constraint:constraint-layout:1.1.3'
    testImplementation 'junit:junit:4.12'
    androidTestImplementation 'com.android.support.test:runner:1.0.2'
    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'
    implementation 'com.android.support:design:28.0.0'
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>使用AS打开Flutter2App工程，重新构建项目，即可成功的将Flutter加入Android工程。</p> <p>在Android工程中创建Flutter的View
Flutter提供了两种方式让Android工程来引用组件，一种是View，一种是Fragment，这里选用View来进行讲解，Fragment同理。 这里我们用两种方式来引入FLutter，本质是还是是作为一个view引入布局还是将FlutterView作为Activity的根View。</p> <p>以单个view引入布局
FlutterView flutterView = Flutter.createView(this, getLifecycle(), &quot;route&quot;);
通过上面很简单的一个方法，我们就能通过Flutter创建出一个view，这个方法提供三个参数，第一个是Activity，第二个参数是一个Lifecycle对象，我们之间取Activity的lifecycle即可，第三个参数是告诉Flutter我们要创建一个什么样的view，这个字符串参数可以在Flutter工程中获取得到。
创建出这个FlutterView之后就可以按常规的操作来将它加入到任何你想要的布局中去了。</p> <p>以根view作为Activity
创建一个空的Activity，用Flutter创建一个View作为页面的根View：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlutterActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">FlutterToAndroidCHANNEL</span> <span class="token operator">=</span> <span class="token string">&quot;com.wangzs.native2flutter&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">AndroidToFlutterCHANNEL</span> <span class="token operator">=</span> <span class="token string">&quot;com.wangzs.flutter2native&quot;</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">requestWindowFeature</span><span class="token punctuation">(</span><span class="token class-name">Window</span><span class="token punctuation">.</span>FEATURE_NO_TITLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFlags</span><span class="token punctuation">(</span><span class="token class-name">WindowManager</span><span class="token punctuation">.</span><span class="token class-name">LayoutParams</span><span class="token punctuation">.</span>FLAG_FULLSCREEN<span class="token punctuation">,</span>
                <span class="token class-name">WindowManager</span><span class="token punctuation">.</span><span class="token class-name">LayoutParams</span><span class="token punctuation">.</span>FLAG_FULLSCREEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_flutter_acticity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FrameLayout</span> frameLayout <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>rl_flutter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FlutterView</span> flutterView <span class="token operator">=</span> <span class="token class-name">Flutter</span><span class="token punctuation">.</span><span class="token function">createView</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getLifecycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;route&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FrameLayout</span><span class="token punctuation">.</span><span class="token class-name">LayoutParams</span> layoutParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FrameLayout</span><span class="token punctuation">.</span><span class="token class-name">LayoutParams</span><span class="token punctuation">(</span><span class="token class-name">FrameLayout</span><span class="token punctuation">.</span><span class="token class-name">LayoutParams</span><span class="token punctuation">.</span>MATCH_PARENT<span class="token punctuation">,</span> <span class="token class-name">FrameLayout</span><span class="token punctuation">.</span><span class="token class-name">LayoutParams</span><span class="token punctuation">.</span>MATCH_PARENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        flutterView<span class="token punctuation">.</span><span class="token function">setLayoutParams</span><span class="token punctuation">(</span>layoutParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
        frameLayout<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span>flutterView<span class="token punctuation">,</span> layoutParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">EventChannel</span><span class="token punctuation">(</span>flutterView<span class="token punctuation">,</span> <span class="token class-name">AndroidToFlutterCHANNEL</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setStreamHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EventChannel</span><span class="token punctuation">.</span><span class="token class-name">StreamHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onListen</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">EventChannel</span><span class="token punctuation">.</span><span class="token class-name">EventSink</span> eventSink<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">String</span> androidParmas <span class="token operator">=</span> <span class="token string">&quot;来自android原生的参数&quot;</span><span class="token punctuation">;</span>
                        eventSink<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>androidParmas<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCancel</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">MethodChannel</span><span class="token punctuation">(</span>flutterView<span class="token punctuation">,</span> <span class="token class-name">FlutterToAndroidCHANNEL</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMethodCallHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MethodChannel</span><span class="token punctuation">.</span><span class="token class-name">MethodCallHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMethodCall</span><span class="token punctuation">(</span><span class="token class-name">MethodCall</span> methodCall<span class="token punctuation">,</span> <span class="token class-name">MethodChannel</span><span class="token punctuation">.</span><span class="token class-name">Result</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token comment">//接收来自flutter的指令oneAct</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>methodCall<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;withoutParams&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token comment">//跳转到指定Activity</span>
                    <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">FlutterActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">Main2Activity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//返回给flutter的参数</span>
                    result<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//接收来自flutter的指令twoAct</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>methodCall<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;withParams&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token comment">//解析参数</span>
                    <span class="token class-name">String</span> text <span class="token operator">=</span> methodCall<span class="token punctuation">.</span><span class="token function">argument</span><span class="token punctuation">(</span><span class="token string">&quot;flutter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//带参数跳转到指定Activity</span>
                    <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">FlutterActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">Main2Activity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//返回给flutter的参数</span>
                    result<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    result<span class="token punctuation">.</span><span class="token function">notImplemented</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p>这里我们并没有使用setContentView而是是用了addContentView这个方法，原因是这样的：</p> <p>虽然FLutter的加载速度非常快，但是这个过程依然存在，在创建FLutterView之前我们先给ContentView设置了一个R.layout.activity_native布局，这个布局可以作为FlutterView加载完成之前展示给用户的界面，当然大部分情况下用户根本感知不到这个界面Flutter已经加载完成了，但我们仍需要它，因为debug模式下造成Flutter的加载速度并不是非常快，这个界面可以给开发人员看，还有就是如果没有这个界面的话在Activity的加载过程会出现一个黑色的闪屏，而这个情况对用户来说并不友好。</p> <p>在Flutter工程中根据不同的route创建不同的组件
用AndroidStudio在你的项目跟目录/plugin_test打开Flutter工程，这时候AndroidStudio插件会识别到Flutter工程并以Flutter工程进行加载。</p> <p>忽略掉.android和.ios文件夹之后你会发现，这个FLutter工程和完整的Flutter工程并没有任何不同，你依然能够以完整Flutter工程的流程来进行Flutter开发并启动调试，这是一个非常人性化的设计。</p> <p>上面我们在原生Android工程中以View的形式调用了Flutter，而Flutter本质上是只有一个入口的，也就是main.dart文件中的main函数：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>void main() {
  runApp(new MyApp());
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>我们的目的是根据原生工程的调用让Flutter生成不同的组件作为View来供原生工程使用，那么我们就可以从这个main函数来入手。</p> <p>通过文档我们可以通过window的全局变量中获取到当前的routeName，这个值正是上面通过原生工程传给Flutter的标识，有了这个标识就可以简单的做判断来进行不同的组件创建了：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">import</span> <span class="token string">'dart:ui'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//根据不同的标识创建不同的组件给原生工程调用Widget _widgetForRoute(String route) {</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'route_input'</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string">'Flutter Demo Home Page1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'route_create'</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string">'Flutter Demo Home Page2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string">'Flutter Demo Home Page2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>让Flutter模块支持热加载
首先在Flutter目录下启动监听服务，在你的项目根目录/plugin_test下执行</p> <p>flutter attach
执行后，监听服务会等待并监听debug应用中flutter的状态</p> <p>然后在打开Flutter2App项目的AS中以正常方式调试运行，在真机或模拟器中运行app后并不会立即出发flutter的监听服务，当flutter的view或Fragment激活时才会触发。</p> <p>当flutter的监听服务和app建立连接后，终端会出现如下输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ flutter attach -d W8
Waiting for a connection from Flutter on vivo x21...
Done.
Syncing files to device vivo x21...                          8.7s
🔥  To hot reload changes while running, press &quot;r&quot;. To hot restart (and rebuild state), press &quot;R&quot;.
An Observatory debugger and profiler on  vivo x21 is available at: http://127.0.0.1:54218/
For a more detailed help message, press &quot;h&quot;. To quit, press &quot;q&quot;.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这时我们修改flutter工程中的dart代码文件，保存后在终端中点击r键即可进行热加载，R键进行热重启。</p> <p><a href="https://github.com/flutter/flutter/wiki/Add-Flutter-to-existing-apps" target="_blank" rel="noopener noreferrer">参考链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/kingkadienm/Flutter2App" target="_blank" rel="noopener noreferrer">Demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/flutter/2019-11-22_2.html" class="prev">
          Flutter学习之Dart运算符
        </a></span> <span class="next"><a href="/flutter/Flutter2Android_2.html">
          Android嵌套Flutter(上).md
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.dc8b9c2e.js" defer></script><script src="/assets/js/2.2ce75cd2.js" defer></script><script src="/assets/js/20.a6cf2b18.js" defer></script>
  </body>
</html>
